
include("${CMAKE_CURRENT_LIST_DIR}/CDashInit.cmake")

setup(Coverage)
# remove old counting files
file(GLOB_RECURSE COUNTER_FILES ${CTEST_BINARY_DIR}/*.gcda
    ${CTEST_BINARY_DIR}/*.cover)
# run the tests
ctest_test(BUILD "${CTEST_BINARY_DIRECTORY}" RETURN_VALUE ret)
# copy the Python files to the directory in the naming convention expected
execute_process(COMMAND ${CTEST_CMAKE_COMMAND} -E copy_directory 
    ${CTEST_BINARY_DIRECTORY}/python ${CTEST_BINARY_DIRECTORY}/
    WORKING_DIRECTORY ${CTEST_BINARY_DIRECTORY})
# process the coverage
ctest_coverage(BUILD "${CTEST_BINARY_DIRECTORY}" RETURN_VALUE ret)
# submit
submit(Coverage)
# remove the extraenous python files
execute_process (COMMAND ${CTEST_CMAKE_COMMAND} -E remove 
    ${CTEST_BINARY_DIRECTORY}/toast.*.py
    WORKING_DIRECTORY ${CTEST_BINARY_DIRECTORY})

message(" -- Finished ${MODEL} Coverage - ${CTEST_BUILD_NAME} --")
