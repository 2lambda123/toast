#!/bin/bash

#SBATCH --partition=@QUEUE@
@CONSTRAINT@
#SBATCH --account=@ACCOUNT@
#SBATCH --nodes=@NODES@
#SBATCH --time="@TIME@"
#SBATCH --job-name=@JOB_NAME@
#SBATCH --output=out_@JOB_NAME@_@MACHINE@_%j.log

# set environment paths
export LOG_OUT=/dev/stdout
export PATH="${PROJECT_BIN_PATH}:@PATH@"
export PYTHONPATH="${PROJECT_PYC_PATH}:@PYTHONPATH@"

if [ "$(uname -s)" = "Darwin" ]; 
then
    export DYLD_LIBRARY_PATH="${PROJECT_LIB_PATH}:@DYLD_LIBRARY_PATH@"
else
    export LD_LIBRARY_PATH="${PROJECT_LIB_PATH}:@LD_LIBRARY_PATH@"
fi

$@

if [ "@USE_SLURM@" = "ON" ]; then
    FNOTES=@JOB_NAME@_notes.cmake
    echo > ${FNOTES}
    for i in out_@JOB_NAME@_@MACHINE@_*.log
    do
        cat >> ${FNOTES} <<EOF
list(APPEND CTEST_NOTES_FILES "${i}")
        EOF
    done
fi
